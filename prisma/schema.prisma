generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

// ==================== AUTH MODELS ====================

model User {
    id            String    @id @default(cuid())
    name          String?
    email         String    @unique
    emailVerified DateTime?
    image         String?
    password      String? // For credentials provider (hashed)
    role          Role      @default(USER)
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt

    accounts Account[]
    sessions Session[]
}

model Account {
    id                String  @id @default(cuid())
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String? @db.Text
    access_token      String? @db.Text
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String? @db.Text
    session_state     String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

// ==================== PRODUCT MODELS ====================

model Product {
    id             String   @id @default(cuid())
    name           String
    description    String
    type           String // Sauna category: cube, barrel, indoor, outdoor, outdoorshowers
    designation    String // Material/collection: e.g., "Canadian Timber"
    collectionType String?
    series         String?
    dimensions     String?
    specifications Json?
    basePrice      Decimal
    woodType       String?
    displayOrder   Int      @default(0) // Control display order on pages
    isActive       Boolean  @default(true)
    isFeatured     Boolean  @default(false)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    heaters ProductHeater[]
    options ProductOption[]
    images  Image[]
}

model Heater {
    id          String     @id @default(cuid())
    type        HeaterType @default(ELECTRIC)
    name        String
    model       String     @unique
    description String
    basePrice   Decimal

    // Shared specifications for both types
    specifications Json? // Room size, stone capacity, dimensions, weight
    options        Json? // Stones, controls, safety railing
    installation   Json? // Requirements, safety distances
    warranty       Json? // Duration and description
    features       Json? // Array of feature objects

    // Type-specific specifications
    electricSpec Json? // Electric only: power, voltage, electricianRequired, includes, requires
    woodSpec     Json? // Wood only: fuel type, chimney specs, etc.

    isActive   Boolean  @default(true)
    isFeatured Boolean  @default(false)
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    products ProductHeater[]
    images   Image[]
}

model ProductHeater {
    productId String
    heaterId  String

    product Product @relation(fields: [productId], references: [id])
    heater  Heater  @relation(fields: [heaterId], references: [id])

    @@id([productId, heaterId])
}

enum OptionType {
    COLOR
    FINISH
    STONE
    HEATER
    INSTALLATION
    WOOD_TYPE
    CONTROL_TYPE
}

enum StoneType {
    NATURAL
    ARTIFICIAL
}

enum FinishType {
    POLISHED
    BRUSHED
}

model ProductOption {
    id         String     @id @default(cuid())
    name       String
    optionType OptionType
    category   String? // Group related options (e.g., "installation", "wood_finish")
    price      Decimal
    isRequired Boolean    @default(false)
    isDefault  Boolean    @default(false)

    product   Product @relation(fields: [productId], references: [id])
    productId String
}

model Image {
    id        String  @id @default(cuid())
    url       String
    altText   String?
    order     Int?
    isPrimary Boolean @default(false)

    product   Product? @relation(fields: [productId], references: [id])
    productId String?

    heater   Heater? @relation(fields: [heaterId], references: [id])
    heaterId String?
}

enum Role {
    ADMIN
    USER
}

enum HeaterType {
    ELECTRIC
    WOOD
}
